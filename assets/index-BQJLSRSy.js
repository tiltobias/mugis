import{e as H,f as d,j as e,M as ye,S as xe,F as be,h as ge,k as je,l as ve,m as Le,G as Se,X as te,I as se,n as re,C as Ce,o as Ne,q as we,t as ke,w as Ee,x as Pe,y as Fe,z as Te,E as Me,T as ne,P as Oe,A as Ie,Z as Re,B as $e,D as oe,H as le,J as ae,K as Be,L as z,N as q,O as Ae,Q as Ue,U as Ve,V as We,W as He,Y as ze,_ as qe,$ as Ge,a0 as Je,a1 as Ze}from"./vendor-1ZAvUA_E.js";import{m as B,M as Ye}from"./vendor-mapbox-BqvCt9Kj.js";import{b as ie,i as ce,u as _e,c as Ke,d as Xe,a as K,f as R,v as Qe,e as G,g as De,p as et,h as X,l as tt}from"./vendor-turf-8u3JTLNS.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function l(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=l(o);fetch(o.href,i)}})();const $=H(s=>({mapRef:d.createRef(),setMapRef:t=>s({mapRef:t}),mapReady:!1,setMapReady:t=>s({mapReady:t}),basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},setBasemap:t=>s(l=>t.url===l.basemap.url?l:{basemap:t}),resetMapStore:()=>s(()=>({mapReady:!1,basemap:{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"}}))}));function Q(s){return s==="Polygon"||s==="MultiPolygon"?"fill":s==="LineString"||s==="MultiLineString"?"line":s==="Point"||s==="MultiPoint"?"circle":null}const w=H(s=>({layers:[],resetLayerStore:()=>s(()=>({layers:[]})),loadProjectLayers:t=>s(()=>({layers:t})),addLayer:t=>s(l=>{const r=u=>l.layers.some(n=>n.id===u)?r(u+"1"):u,o=t.featureCollection.features[0].geometry.type,i=Q(o);if(t.featureCollection.features.forEach(u=>{if(Q(u.geometry.type)!==i)throw new Error(`All features must have the same geometry (rendering) type, found both ${o} and ${u.geometry.type}`)}),!i)throw new Error("Unsupported geometry type: "+o);t.name||(t.name=i==="fill"?"polygon":i==="line"?"line":i==="circle"?"point":"not possible");const c={h:Math.floor(Math.random()*360),s:90,l:48,a:i==="fill"?.7:1};return{layers:[{featureCollection:t.featureCollection,id:r(t.name),name:t.name,renderingType:i,visible:!0,color:c,outline:t.outline},...l.layers]}}),moveLayerUp:t=>s(l=>{const r=l.layers.findIndex(i=>i.id===t);if(r===0)return l;const o=[...l.layers];return o.splice(r-1,0,o.splice(r,1)[0]),{layers:o}}),moveLayerDown:t=>s(l=>{const r=l.layers.findIndex(i=>i.id===t);if(r===l.layers.length-1)return l;const o=[...l.layers];return o.splice(r+1,0,o.splice(r,1)[0]),{layers:o}}),deleteLayer:t=>s(l=>({layers:l.layers.filter(r=>r.id!==t)})),toggleLayerVisibility:t=>s(l=>({layers:l.layers.map(r=>r.id===t?{...r,visible:!r.visible}:r)})),toggleLayerVisibilityAll:()=>s(t=>{const l=t.layers.every(r=>r.visible);return{layers:t.layers.map(r=>({...r,visible:!l}))}}),changeLayerColor:(t,l)=>s(r=>({layers:r.layers.map(o=>o.id===t?{...o,color:l}:o)})),updateAllLayers:()=>s(t=>({layers:t.layers.map(l=>({...l,updater:l.updater?l.updater+1:1}))})),changeLayerName:(t,l)=>s(r=>({layers:r.layers.map(o=>o.id===t?{...o,name:l}:o)}))}));B.accessToken="pk.eyJ1IjoidG9iaWFuZCIsImEiOiJjbTdiMGZwemwwNmxlMnFyNTV4YWh2ZzB3In0.B3fVZMQOYEs2V23kKWB5XQ";const st=()=>{const{mapRef:s,mapReady:t,setMapReady:l,basemap:r}=$(),{addLayer:o,updateAllLayers:i}=w(),c=d.useRef(null);d.useEffect(()=>{var p,x,g,j,v,y;if(!t&&c.current){c.current.innerHTML="",s.current=new B.Map({container:c.current,style:r.url,center:[10.4,63.425],zoom:12}),(p=s.current)==null||p.addControl(new B.FullscreenControl,"top-right"),(x=s.current)==null||x.addControl(new B.NavigationControl({visualizePitch:!0}),"top-right"),(g=s.current)==null||g.addControl(new B.ScaleControl,"bottom-right");const L=new Ye({displayControlsDefault:!1,controls:{point:!0,line_string:!0,polygon:!0},boxSelect:!1});(j=s.current)==null||j.addControl(L,"bottom-left"),(v=s.current)==null||v.on("draw.create",()=>{o({featureCollection:L.getAll(),name:null}),L.deleteAll()}),(y=s.current)==null||y.on("style.load",()=>{l(!0)})}},[s,o,t,l,r]);const[f,u]=d.useState(!1),n=d.useRef(r),[a,h]=d.useState(r);return d.useEffect(()=>{var p;n.current.url!==r.url&&(n.current=r),!f&&a.url!==n.current.url&&(u(!0),t&&s.current&&(s.current.setStyle(n.current.url),h(r)),(p=s.current)==null||p.once("style.load",()=>{i()}),setTimeout(()=>{u(!1)},200))},[r,s,t,f,a,i]),e.jsx("div",{ref:c,className:"mapContainer"})},I=(s,t,l=[])=>{d.useEffect(()=>{const r=o=>{const i=o.target;s.current&&!s.current.contains(i)&&!l.some(c=>{var f;return(f=c.current)==null?void 0:f.contains(i)})&&t()};return document.addEventListener("click",r),()=>{document.removeEventListener("click",r)}},[s,t,l])},rt=()=>{const[s,t]=d.useState(!1),l=d.useRef(null);I(l,()=>{t(!1)});const[r,o]=d.useState(null),{basemap:i,setBasemap:c}=$(),f=[{url:"mapbox://styles/mapbox/streets-v12",name:"Streets"},{url:"mapbox://styles/mapbox/outdoors-v12",name:"Outdoors"},{url:"mapbox://styles/mapbox/light-v11",name:"Light"},{url:"mapbox://styles/mapbox/dark-v11",name:"Dark"},{url:"mapbox://styles/mapbox/satellite-v9",name:"Satellite"},{url:"mapbox://styles/mapbox/satellite-streets-v12",name:"Satellite Streets"},{url:"mapbox://styles/mapbox/navigation-day-v1",name:"Navigation Day"},{url:"mapbox://styles/mapbox/navigation-night-v1",name:"Navigation Night"},{url:"mapbox://styles/tobiand/cm8rbg7j900be01sa5wc6d4lq",name:"Off (white)"},{url:"mapbox://styles/tobiand/cm8rbd89l00az01sb97a8hfyh",name:"Off (black)"}];return e.jsxs("div",{className:"basemap",ref:l,children:[e.jsxs("button",{type:"button",onClick:()=>t(!s),children:[e.jsx(ye,{})," Change basemap"]}),s&&e.jsx("div",{className:"basemapPopover",children:e.jsx("ul",{onMouseEnter:()=>{o(i)},onMouseLeave:()=>{c(r),o(null)},children:f.map(u=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{o(u)},onMouseEnter:()=>{c(u)},className:`basemapOption ${r===null&&u.name===i.name||r!==null&&u.name===r.name?"active":""}`,children:u.name})},u.name))})})]})},nt=H(s=>({theme:localStorage.getItem("theme")||"light",setTheme:t=>s(l=>(localStorage.setItem("theme",t),t===l.theme?l:{theme:t}))})),ot=()=>{const[s,t]=d.useState(!1),l=d.useRef(null);I(l,()=>{t(!1)});const{layers:r,resetLayerStore:o,loadProjectLayers:i}=w(),{basemap:c,setBasemap:f,resetMapStore:u}=$(),{theme:n,setTheme:a}=nt(),h=()=>{o(),u()},p=()=>{const v={layers:r,basemap:c},y=new Blob([JSON.stringify(v)],{type:"application/json"}),L=URL.createObjectURL(y),C=document.createElement("a");C.href=L,C.download="μGIS_project.mugis",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(L)},x=d.useRef(null),g=()=>{var v;(v=x.current)==null||v.click()},j=v=>{const y=v.target.files;if(!y){console.log("no file selected");return}const L=new FileReader;L.onload=C=>{var E;try{const P=JSON.parse((E=C.target)==null?void 0:E.result);i(P.layers),f(P.basemap)}catch(P){console.log(P)}},L.readAsText(y[0])};return d.useEffect(()=>{document.documentElement.setAttribute("data-theme",n)},[n]),e.jsxs("div",{className:"settings",ref:l,children:[e.jsx("button",{type:"button",className:"toolButton",onClick:()=>{t(!s)},children:e.jsx(xe,{})}),s&&e.jsx("div",{className:"settingsPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:h,children:[e.jsx(be,{})," New project"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:p,children:[e.jsx(ge,{})," Save project"]})}),e.jsxs("li",{children:[e.jsx("input",{ref:x,type:"file",accept:".mugis",onChange:j}),e.jsxs("button",{type:"button",onClick:g,children:[e.jsx(je,{})," Load project"]})]}),e.jsx("li",{children:e.jsx(rt,{})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:v=>{v.stopPropagation(),a(n==="light"?"dark":"light")},children:[n==="light"?e.jsx(ve,{}):e.jsx(Le,{})," Toggle theme"]})}),e.jsx("li",{children:e.jsxs("a",{href:"https://github.com/tiltobias/mugis/blob/main/docs/tutorial.md",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Se,{})," Go to tutorial"]})})]})})]})},M=({children:s,buttonLabel:t,onFormSubmit:l,buttonIcon:r,description:o,errorMessage:i})=>{const[c,f]=d.useState(!1),[u,n]=d.useState(!1),[a,h]=d.useState(!1);return e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"toolButton",onClick:()=>f(!c),children:[r," ",t]}),c&&e.jsx("div",{className:"cover",onClick:p=>{p.target===p.currentTarget&&f(!1)},children:e.jsx("div",{className:"modal"+(u?" loading":""),children:e.jsxs("form",{onSubmit:p=>{p.preventDefault(),n(!0),setTimeout(()=>{l()&&f(!1),n(!1)},0)},children:[e.jsx("button",{type:"button",className:"modalCloseButton",onClick:()=>f(!1),children:e.jsx(te,{})}),e.jsxs("div",{className:"modalHeader",children:[e.jsx("h3",{children:t}),o&&e.jsx("button",{type:"button",onClick:()=>h(!a),children:e.jsx(se,{})})]}),a&&e.jsx("p",{className:"modalDescription",children:o}),s,i&&e.jsx("p",{className:"modalErrorMessage",children:i}),e.jsx("button",{type:"submit",children:"Submit"})]})})})]})};function ue({size:s=120}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"none",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1},d:"M 15,55 50,80 70,40 105,65"}),e.jsx("circle",{cx:"15",cy:"55",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"50",cy:"80",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"70",cy:"40",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"105",cy:"65",r:"12",fill:"currentColor"})]})}function de({size:s=120}){return e.jsx("svg",{width:s,height:s,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("circle",{cx:"60",cy:"60",r:"25",fill:"currentColor"})})}function pe({size:s=120}){return e.jsxs("svg",{width:s,height:s,viewBox:"0 0 120 120",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{style:{fill:"currentColor",stroke:"currentColor",strokeWidth:16,strokeLinejoin:"round",strokeOpacity:1,fillOpacity:.5},d:"M 60,17 100,48 88,95 H 32 L 20,48 60,17"}),e.jsx("circle",{cx:"60",cy:"17",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"100",cy:"48",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"88",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"32",cy:"95",r:"12",fill:"currentColor"}),e.jsx("circle",{cx:"20",cy:"48",r:"12",fill:"currentColor"})]})}function lt(){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"20",height:"20",x:"2",y:"2",rx:"2"}),e.jsx("circle",{cx:"7",cy:"9",r:"1"}),e.jsx("circle",{cx:"9",cy:"17",r:"1"}),e.jsx("circle",{cx:"17",cy:"10",r:"1"}),e.jsx("line",{x1:"11.7436",y1:"12.0641",x2:"19.5625",y2:"21"}),e.jsx("line",{x1:"11.7436",y1:"12.0641",x2:"12.65",y2:"3"}),e.jsx("line",{x1:"11.7436",y1:"12.0641",x2:"3",y2:"14.25"})]})}const D=({name:s,type:t,index:l,color:r,onRemove:o})=>e.jsxs("div",{className:"layerItem",children:[e.jsxs("span",{className:"layerIndex",children:[l+1,"."]}),e.jsxs("div",{className:"colorPickerButton",style:{color:`hsl(${r.h},${r.s}%,${r.l}%)`},children:[t==="circle"&&e.jsx(de,{}),t==="line"&&e.jsx(ue,{}),t==="fill"&&e.jsx("div",{className:"polygonShrinker",children:e.jsx(pe,{})})]}),e.jsx("div",{className:"layerName",children:e.jsx("span",{children:s})}),o&&e.jsx("button",{type:"button",onClick:i=>{o(),i.stopPropagation()},children:e.jsx(re,{})})]}),k=({selectedLayers:s,setSelectedLayers:t,renderingType:l=void 0,multiple:r=!1,unselectableLayerIds:o=[]})=>{const{layers:i}=w(),[c,f]=d.useState(!1),u=d.useRef(null),n=d.useRef(null);return I(u,()=>{f(!1)}),d.useEffect(()=>{var a,h,p,x,g,j;u.current&&n.current&&((h=n.current)==null||h.style.setProperty("max-height",`${window.innerHeight-((a=u.current)==null?void 0:a.getBoundingClientRect().bottom)-10}px`),(x=n.current)==null||x.style.setProperty("width",`${(p=u.current)==null?void 0:p.getBoundingClientRect().width}px`),(j=n.current)==null||j.style.setProperty("top",`${((g=u.current)==null?void 0:g.getBoundingClientRect().bottom)+window.scrollY}px`))},[c,s]),d.useEffect(()=>{s.forEach(a=>{o.includes(a.id)&&t(h=>h.filter(p=>p.id!==a.id))})},[o,s,t]),e.jsxs("div",{className:"selectLayersContainer",ref:u,onClick:()=>{f(!c)},children:[e.jsx("ol",{className:"selectedList",children:s.length===0?e.jsx("p",{children:"No layer selected"}):i.map((a,h)=>l&&a.renderingType!==l||!s.some(p=>p.id===a.id)?null:e.jsx("li",{children:e.jsx(D,{name:a.name,type:a.renderingType,index:h,color:a.color,onRemove:()=>{t(p=>p.filter(x=>x.id!==a.id))}})},a.id))}),c&&e.jsxs("div",{className:"selectListContainer",onClick:a=>{r&&a.stopPropagation()},ref:n,children:[e.jsx("h4",{children:"Select Layers"}),e.jsx("ol",{className:"selectList",children:i.map((a,h)=>l&&a.renderingType!==l||s.some(p=>p.id===a.id)||o.includes(a.id)?null:e.jsx("li",{className:"selectListItem",onClick:()=>{t(r?p=>[...p,a]:[a])},children:e.jsx(D,{name:a.name,type:a.renderingType,index:h,color:a.color})},a.id))||e.jsx("p",{children:"No layers available"})})]})]})},at=()=>{const{addLayer:s}=w(),[t,l]=d.useState([]),[r,o]=d.useState(""),[i,c]=d.useState(""),[f,u]=d.useState("");d.useEffect(()=>{t[0]&&c(`buffer(${t[0].name}, ${r}m)`)},[t,r]);const n=()=>{if(!t[0]||r==="")return u("Please select a layer and enter a radius"),!1;const h=t[0].featureCollection,p=ie(h,r*.001,{units:"kilometers"});return!p||p.features.length===0?(u("No results found for the given radius."),!1):(s({featureCollection:p,name:i}),l([]),o(""),c(""),u(""),!0)};return e.jsxs(M,{buttonLabel:"Buffer",onFormSubmit:n,buttonIcon:e.jsx(Ce,{}),description:"Create a buffer around the selected layer's features. The buffer radius is specified in meters, and can be a positive or negative decimal number. The output will be a polygon layer containing the buffered geometries.",errorMessage:f,children:[e.jsx("span",{className:"toolInputLabel",children:"Select a layer:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:l}),e.jsx("span",{className:"toolInputLabel",children:"Buffer radius [m]:"}),e.jsx("input",{type:"number",className:"toolNumberInput",value:r,onChange:h=>o(h.target.value)}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:i,onChange:h=>c(h.target.value)})]})},it=()=>{const{addLayer:s}=w(),[t,l]=d.useState([]),[r,o]=d.useState(""),[i,c]=d.useState("");d.useEffect(()=>{if(t&&t.length>=2){let n=t[0].name;for(let a=1;a<t.length;a++)n+=`, ${t[a].name}`;o(`intersect(${n})`)}},[t]);const f=()=>{if(!t||t.length<2)return c("Please select two layers"),!1;const n={type:"FeatureCollection",features:t[0].featureCollection.features};for(let a=1;a<t.length;a++){const h=t[a].featureCollection,p=[];n.features.forEach(x=>{h.features.forEach(g=>{const j=ce({type:"FeatureCollection",features:[x,g]});j&&p.push(j)})}),n.features=p}return!n||n.features.length===0?(c("No results found"),!1):(s({featureCollection:n,name:r}),l([]),o(""),c(""),!0)};return e.jsxs(M,{buttonLabel:"Intersect",onFormSubmit:f,buttonIcon:e.jsx(Ne,{}),description:"Intersect two or more polygon layers to create a new layer containing the overlapping areas. The output will be a polygon layer containing the intersected geometries.",errorMessage:i,children:[e.jsx("span",{className:"toolInputLabel",children:"Select two or more polygon layers:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill",multiple:!0}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:r,onChange:n=>o(n.target.value)})]})},ct=()=>{const{addLayer:s}=w(),[t,l]=d.useState([]),[r,o]=d.useState(""),[i,c]=d.useState("");d.useEffect(()=>{if(t&&t.length>=2){let n=t[0].name;for(let a=1;a<t.length;a++)n+=`, ${t[a].name}`;o(`union(${n})`)}},[t]);const f=()=>{if(!t||t.length<2)return c("Please select two layers"),!1;const n=t.flatMap(h=>h.featureCollection.features),a=_e({type:"FeatureCollection",features:n});return a?(s({featureCollection:{type:"FeatureCollection",features:[a]},name:r}),l([]),o(""),c(""),!0):(c("No results found"),!1)};return e.jsxs(M,{buttonLabel:"Union",onFormSubmit:f,buttonIcon:e.jsx(we,{}),description:"Create a union of two or more polygon layers. The output will be a polygon layer containing the union of all the geometries.",errorMessage:i,children:[e.jsx("span",{className:"toolInputLabel",children:"Select two or more polygon layers:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill",multiple:!0}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:r,onChange:n=>o(n.target.value)})]})},ut=()=>{var h;const{addLayer:s}=w(),[t,l]=d.useState([]),[r,o]=d.useState([]),[i,c]=d.useState(""),[f,u]=d.useState("");d.useEffect(()=>{t[0]&&r[0]&&c(`difference(${t[0].name}, ${r[0].name})`)},[t,r]);const n=()=>{if(!t[0]||!r[0])return u("Please select two layers"),!1;const p={type:"FeatureCollection",features:[]},x=t[0].featureCollection,g=r[0].featureCollection,j=Ke(g).features[0];return x.features.forEach(v=>{const y=Xe({type:"FeatureCollection",features:[v,j]});y&&p.features.push(y)}),!p||p.features.length===0?(u("No results found"),!1):(s({featureCollection:p,name:i}),l([]),o([]),c(""),u(""),!0)};return e.jsxs(M,{buttonLabel:"Difference",onFormSubmit:n,buttonIcon:e.jsx(ke,{}),description:"Create a difference of two polygon layers. The output will be a polygon layer containing the geometries from the first layer that do not intersect with the second layer.",errorMessage:f,children:[e.jsx("span",{className:"toolInputLabel",children:"Select a polygon layer:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill"}),e.jsx("span",{className:"toolInputLabel",children:"Select polygon layer to subtract:"}),e.jsx(k,{selectedLayers:r,setSelectedLayers:o,renderingType:"fill",unselectableLayerIds:[(h=t[0])==null?void 0:h.id]}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:i,onChange:p=>c(p.target.value)})]})},W=({options:s,selectedOption:t,setSelectedOption:l,placeholder:r="Select an option",clearable:o=!1})=>{const[i,c]=d.useState(!1),f=d.useRef(null),u=d.useRef(null);return I(f,()=>{c(!1)}),d.useEffect(()=>{var n,a,h,p,x,g;f.current&&u.current&&((a=u.current)==null||a.style.setProperty("max-height",`${window.innerHeight-((n=f.current)==null?void 0:n.getBoundingClientRect().bottom)-10}px`),(p=u.current)==null||p.style.setProperty("width",`${(h=f.current)==null?void 0:h.getBoundingClientRect().width}px`),(g=u.current)==null||g.style.setProperty("top",`${((x=f.current)==null?void 0:x.getBoundingClientRect().bottom)+window.scrollY}px`))},[i,t]),e.jsxs("div",{className:"selectLayersContainer select",ref:f,onClick:()=>{c(!i)},children:[e.jsx("div",{className:"selectedList",children:t?e.jsxs("div",{className:"layerItem",children:[e.jsx("div",{className:"layerName",children:t}),o&&i&&e.jsx("button",{type:"button",onClick:n=>{l(""),n.stopPropagation()},children:e.jsx(re,{})})]}):e.jsx("div",{className:"layerName",children:r})}),i&&e.jsx("div",{className:"selectListContainer",ref:u,children:e.jsxs("ol",{className:"selectList",children:[s.map(n=>e.jsx("li",{className:"selectListItem",onClick:a=>{a.stopPropagation(),l(n),c(!1)},children:e.jsx("div",{className:"selectItem",children:n})},n)),s.length===0&&e.jsx("p",{children:"No options available"})]})})]})},dt=()=>{var x;const{addLayer:s}=w(),[t,l]=d.useState([]),[r,o]=d.useState(!1),[i,c]=d.useState(""),[f,u]=d.useState(""),[n,a]=d.useState("");d.useEffect(()=>{t[0]&&u(r&&i?`dissolve(${t[0].name}, ${i})`:`dissolve(${t[0].name})`)},[t,r,i]);const h=()=>{if(!t[0])return a("Please select a layer"),!1;const g=t[0].featureCollection,j=r&&i?K(R(g),{propertyName:i}):K(R(g));return!j||j.features.length===0?(a("No results found"),!1):(s({featureCollection:j,name:f}),l([]),o(!1),c(""),u(""),a(""),!0)};return e.jsxs(M,{buttonLabel:"Dissolve",onFormSubmit:h,buttonIcon:e.jsx(Ee,{}),description:"Dissolve polygons in a layer based on a property or without any property. The output will be a polygon layer containing the dissolved geometries.",errorMessage:n,children:[e.jsx("span",{className:"toolInputLabel",children:"Select a polygon layer:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill"}),e.jsxs("span",{className:r?"toolInputLabel":"",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:g=>o(g.target.checked),id:"checkboxPropertyEnabled"}),e.jsxs("label",{htmlFor:"checkboxPropertyEnabled",children:["Dissolve by property",r&&":"]})]}),r&&e.jsx(W,{options:(x=t[0])!=null&&x.featureCollection.features[0].properties?Object.keys(t[0].featureCollection.features[0].properties):[],selectedOption:i,setSelectedOption:g=>c(g),placeholder:"Select a property",clearable:!0}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:f,onChange:g=>u(g.target.value)})]})},pt=()=>{const{addLayer:s}=w(),[t,l]=d.useState([]),[r,o]=d.useState(!1),[i,c]=d.useState([]),[f,u]=d.useState(""),[n,a]=d.useState("");d.useEffect(()=>{t[0]&&(r&&i[0]?u(`voronoi(${t[0].name}, ${i[0].name})`):u(`voronoi(${t[0].name})`))},[t,i,r]);const h=()=>{if(!t[0])return a("Please select a layer"),!1;const x=R(t[0].featureCollection),g=r&&i[0]?R(i[0].featureCollection):x,j=Qe(x,{bbox:G(g)});return!j||j.features.length===0?(a("No results found"),!1):(j.features=j.features.filter(v=>v.geometry.type==="Polygon"),s({featureCollection:j,name:f,outline:!0}),l([]),o(!1),c([]),u(""),a(""),!0)};return e.jsxs(M,{buttonLabel:"Voronoi",onFormSubmit:h,buttonIcon:e.jsx(lt,{}),description:"Create a Voronoi diagram from a point layer. The output will be a polygon layer containing the Thiessen polygon of each point.",errorMessage:n,children:[e.jsx("span",{className:"toolInputLabel",children:"Select a point layer:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:l,renderingType:"circle"}),e.jsxs("span",{className:r?"toolInputLabel":"",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:x=>o(x.target.checked),id:"checkboxPropertyEnabled"}),e.jsxs("label",{htmlFor:"checkboxPropertyEnabled",children:["Use custom bounding box",r&&":"]})]}),r&&e.jsx(k,{selectedLayers:i,setSelectedLayers:c}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:f,onChange:x=>u(x.target.value)})]})},ft=()=>{const{addLayer:s}=w(),[t,l]=d.useState([]),[r,o]=d.useState(""),[i,c]=d.useState("");d.useEffect(()=>{if(t&&t.length>=1){let n=t[0].name;for(let a=1;a<t.length;a++)n+=`, ${t[a].name}`;o(`bbox(${n})`)}},[t]);const f=()=>{if(!t||t.length<1)return c("Please select one or more layers"),!1;const n=t.flatMap(h=>h.featureCollection.features),a=De(G({type:"FeatureCollection",features:n}));return a?(s({featureCollection:{type:"FeatureCollection",features:[a]},name:r}),l([]),o(""),c(""),!0):(c("No results found"),!1)};return e.jsxs(M,{buttonLabel:"Bbox",onFormSubmit:f,buttonIcon:e.jsx(Pe,{}),description:"Create a bounding box polygon from one or more layers. The output will be a polygon layer containing the bounding box of all the selected geometries.",errorMessage:i,children:[e.jsx("span",{className:"toolInputLabel",children:"Select one or more layers:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:l,multiple:!0}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:r,onChange:n=>o(n.target.value)})]})},mt=()=>{var h;const{addLayer:s}=w(),[t,l]=d.useState([]),[r,o]=d.useState([]),[i,c]=d.useState(""),[f,u]=d.useState("");d.useEffect(()=>{t[0]&&r[0]&&c(`clip(${r[0].name}, ${t[0].name})`)},[r,t]);const n=()=>{if(!t[0]||!r[0])return u("Please select two layers"),!1;let p={type:"FeatureCollection",features:[]};if(r[0].renderingType==="circle")p=et(r[0].featureCollection,t[0].featureCollection);else if(r[0].renderingType==="fill"){const x=t[0].featureCollection,g=r[0].featureCollection;x.features.forEach(j=>{g.features.forEach(v=>{const y=ce({type:"FeatureCollection",features:[v,j]});y&&p.features.push(y)})})}else if(r[0].renderingType==="line"){const x=R(t[0].featureCollection),g=R(r[0].featureCollection);x.features.forEach(j=>{const v=ie(j,.01,{units:"meters"});g.features.forEach(y=>{X(y,v)?p.features.push(y):tt(y,j).features.forEach(C=>{X(C,v)&&p.features.push(C)})})})}else throw new Error("Unknown rendering type");return!p||p.features.length===0?(u("No results found"),!1):(s({featureCollection:p,name:i}),o([]),l([]),c(""),u(""),!0)};return e.jsxs(M,{buttonLabel:"Clip",onFormSubmit:n,buttonIcon:e.jsx(Fe,{}),description:"Clip any type of layer with a polygon layer. The output will be a layer of the same type containing only the features that are within the clip layer.",errorMessage:f,children:[e.jsx("span",{className:"toolInputLabel",children:"Select layer:"}),e.jsx(k,{selectedLayers:r,setSelectedLayers:o}),e.jsx("span",{className:"toolInputLabel",children:"Select polygon layer to clip with:"}),e.jsx(k,{selectedLayers:t,setSelectedLayers:l,renderingType:"fill",unselectableLayerIds:[(h=r[0])==null?void 0:h.id]}),e.jsx("label",{htmlFor:"outputLayerName",children:"Output Layer Name:"}),e.jsx("input",{id:"outputLayerName",type:"text",value:i,onChange:p=>c(p.target.value)})]})},ht=()=>e.jsxs(e.Fragment,{children:[e.jsx(at,{}),e.jsx(it,{}),e.jsx(ct,{}),e.jsx(ut,{}),e.jsx(dt,{}),e.jsx(pt,{}),e.jsx(ft,{}),e.jsx(mt,{})]}),yt=({setWidth:s,setOpen:t})=>{const{mapRef:l}=$(),r=d.useRef(null),[o,i]=d.useState(!1),c=n=>{i(!0),n.preventDefault(),n.stopPropagation()},f=d.useCallback(()=>{i(!1),setTimeout(()=>{var n;(n=l.current)==null||n.resize()},1),setTimeout(()=>{var n;(n=l.current)==null||n.resize()},100)},[l]),u=d.useCallback(n=>{var a;o&&((a=l.current)==null||a.resize(),s(n.clientX),n.clientX<100?t(!1):t(!0))},[o,l,s,t]);return d.useEffect(()=>(window.addEventListener("mousemove",u),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",f)}),[o,u,f]),e.jsx("div",{className:`resizeHandle ${o?"resizing":""}`,onMouseDown:c,ref:r})},xt=({color:s,onChange:t,layerType:l})=>{const[r,o]=d.useState(!1),i=d.useRef(null);return I(i,()=>{o(!1)}),e.jsxs("div",{className:"colorPicker",ref:i,children:[e.jsxs("button",{type:"button",className:"colorPickerButton",onClick:()=>{o(!r)},style:{color:`hsl(${s.h},${s.s}%,${s.l}%)`},children:[l==="circle"&&e.jsx(de,{}),l==="line"&&e.jsx(ue,{}),l==="fill"&&e.jsx("div",{className:"polygonShrinker",children:e.jsx(pe,{})})]}),r&&e.jsx("div",{className:"colorPickerPopover",children:e.jsx(Te,{color:s,onChange:c=>{t(c)}})})]})},bt=({layerId:s,initialLayerName:t,isEditing:l,setIsEditing:r,closeMenu:o})=>{const{changeLayerName:i}=w(),[c,f]=d.useState(t),u=d.useRef(null);return d.useEffect(()=>{l&&u.current&&u.current.focus()},[l,u]),I(u,()=>{l&&(i(s,c),r(!1),o())}),e.jsx("div",{className:"layerNameContainer",children:l?e.jsx("form",{onSubmit:n=>{n.preventDefault(),i(s,c),r(!1)},children:e.jsx("input",{type:"text",value:c,onChange:n=>f(n.target.value),ref:u,onFocus:()=>r(!0),onBlur:()=>i(s,c)})}):e.jsx("div",{className:"layerName",children:e.jsx("span",{onDoubleClick:()=>r(!0),children:c})})})},gt=["=","!=","<","<=",">",">="],jt=["=","!=","contains","does not contain","starts with","does not start with","ends with","does not end with"],V={active:!1,attribute:"",attributeType:"string",operator:"=",value:""},J=H(s=>({selectedLayer:[],setSelectedLayer:t=>s(l=>typeof t=="function"?{selectedLayer:t(l.selectedLayer)}:{selectedLayer:t}),tableOpen:!1,setTableOpen:t=>s(()=>({tableOpen:t})),openTableWithLayer:t=>s(()=>({tableOpen:!0,selectedLayer:t})),filters:[{...V}],resetFilters:()=>s(()=>({filters:[{...V}]})),addFilter:()=>s(t=>{const l={...V};return{filters:[...t.filters,l]}}),removeFilter:t=>s(l=>{const r=[...l.filters];return r.splice(t,1),r.length===0&&r.push({...V}),{filters:r}}),updateFilter:(t,l)=>s(r=>{const o=[...r.filters];return o[t]=l,{filters:o}}),filterConnector:"and",setFilterConnector:t=>s(()=>({filterConnector:t}))}));function ee(s,t){var f,u;const{active:l,attribute:r,attributeType:o,operator:i,value:c}=t;if(!l)return!0;if(o==="number"){const n=(f=s.properties)==null?void 0:f[r];if(n==null)switch(i){case"=":return c===void 0||c===""||Number.isNaN(c);case"!=":return c!==void 0&&c!==""&&!Number.isNaN(c);default:return!1}const a=c;switch(i){case"=":return n===a;case"!=":return n!==a;case"<":return n<a;case"<=":return n<=a;case">":return n>a;case">=":return n>=a;default:return!1}}else{const n=(u=s.properties)==null?void 0:u[r];if(n==null)switch(i){case"=":return c===void 0||c==="";case"!=":return c!==void 0&&c!=="";default:return!1}const a=c;switch(i){case"=":return String(n)===a;case"!=":return String(n)!==a;case"contains":return String(n).includes(a);case"does not contain":return!String(n).includes(a);case"starts with":return String(n).startsWith(a);case"does not start with":return!String(n).startsWith(a);case"ends with":return String(n).endsWith(a);case"does not end with":return!String(n).endsWith(a);default:return!1}}}const vt=({layerData:s,layerAboveId:t,index:l})=>{const[r,o]=d.useState(!1),i=d.useRef(null);I(i,()=>{o(!1)});const{deleteLayer:c,toggleLayerVisibility:f,changeLayerColor:u}=w(),{mapRef:n}=$(),{openTableWithLayer:a}=J();d.useEffect(()=>{var y,L,C,E;(y=n.current)!=null&&y.getSource(s.id)||(L=n.current)==null||L.addSource(s.id,{type:"geojson",data:s.featureCollection}),(C=n.current)!=null&&C.getLayer(s.id)||(E=n.current)==null||E.addLayer({id:s.id,type:s.renderingType,source:s.id,paint:s.renderingType==="fill"?{"fill-color":`hsl(${s.color.h},${s.color.s}%,${s.color.l}%)`,"fill-opacity":s.color.a,...s.outline?{"fill-outline-color":"black"}:{}}:s.renderingType==="line"?{"line-color":`hsl(${s.color.h},${s.color.s}%,${s.color.l}%)`,"line-opacity":s.color.a,"line-width":2}:s.renderingType==="circle"?{"circle-color":`hsl(${s.color.h},${s.color.s}%,${s.color.l}%)`,"circle-opacity":s.color.a,"circle-radius":5}:{}})},[n,s]),d.useEffect(()=>{var y;(y=n.current)==null||y.moveLayer(s.id,t)},[t,s.id,n,s.updater]),d.useEffect(()=>{var y;(y=n.current)==null||y.setLayoutProperty(s.id,"visibility",s.visible?"visible":"none")},[s.visible,n,s.id,s.updater]);const h=y=>{var L,C,E,P,O,A;u(s.id,y),s.renderingType==="fill"?((L=n.current)==null||L.setPaintProperty(s.id,"fill-color",`hsl(${y.h},${y.s}%,${y.l}%)`),(C=n.current)==null||C.setPaintProperty(s.id,"fill-opacity",y.a)):s.renderingType==="line"?((E=n.current)==null||E.setPaintProperty(s.id,"line-color",`hsl(${y.h},${y.s}%,${y.l}%)`),(P=n.current)==null||P.setPaintProperty(s.id,"line-opacity",y.a)):s.renderingType==="circle"&&((O=n.current)==null||O.setPaintProperty(s.id,"circle-color",`hsl(${y.h},${y.s}%,${y.l}%)`),(A=n.current)==null||A.setPaintProperty(s.id,"circle-opacity",y.a))},p=()=>{var y,L;(y=n.current)==null||y.removeLayer(s.id),(L=n.current)==null||L.removeSource(s.id),c(s.id)},x=()=>{const y=new Blob([JSON.stringify(s.featureCollection)],{type:"application/geo+json"}),L=URL.createObjectURL(y),C=document.createElement("a");C.href=L,C.download=s.name+".geojson",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(L)},g=()=>{var L;const y=G(s.featureCollection).slice(0,4);(L=n.current)==null||L.fitBounds(y,{padding:20})},[j,v]=d.useState(!1);return e.jsxs("div",{className:"layerItem",children:[e.jsxs("span",{className:"layerIndex",children:[l+1,"."]}),e.jsx(xt,{color:s.color,onChange:h,layerType:s.renderingType}),e.jsx(bt,{layerId:s.id,initialLayerName:s.name,isEditing:j,setIsEditing:v,closeMenu:()=>o(!1)}),e.jsxs("div",{className:`layerMenu ${r?"open":""}`,ref:i,children:[e.jsx("button",{type:"button",onClick:()=>{o(!r)},children:e.jsx(Me,{})}),r&&e.jsx("div",{className:"layerMenuPopover",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{a([s])},children:[e.jsx(ne,{})," Attribute table"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:y=>{y.stopPropagation(),v(!j)},children:[j?e.jsx(Ie,{}):e.jsx(Oe,{})," Edit layer name"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:g,children:[e.jsx(Re,{})," Zoom to layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:x,children:[e.jsx($e,{})," Download layer"]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:p,children:[e.jsx(oe,{})," Delete layer"]})})]})})]}),e.jsx("button",{type:"button",onClick:()=>f(s.id),children:s.visible?e.jsx(le,{}):e.jsx(ae,{})})]})},Lt=()=>{const{layers:s,moveLayerUp:t,moveLayerDown:l}=w(),[r,o]=d.useState(null),[i,c]=d.useState(null);d.useEffect(()=>{r!==null&&c(r)},[r]);const f=(a,h)=>{o(h),a.dataTransfer.setDragImage(new Image,0,0)},u=(a,h)=>{a.preventDefault(),a.dataTransfer.dropEffect="move",!(r===null||r===h)&&(s.findIndex(p=>p.id===r)<s.findIndex(p=>p.id===h)?l(r):t(r))},n=()=>{o(null)};return e.jsx("ol",{className:"layerList",children:s.map((a,h)=>e.jsx("li",{draggable:!0,className:`layerListItem ${i===a.id?"hovering":""}`,onDragStart:p=>f(p,a.id),onDragOver:p=>u(p,a.id),onDragEnd:n,onMouseOver:()=>r===null?c(a.id):void 0,onMouseOut:()=>r===null?c(null):void 0,children:e.jsx(vt,{layerData:a,layerAboveId:h===0?void 0:s[h-1].id,index:h})},a.id))})},St=({headers:s,headerTypes:t})=>{const{filters:l,addFilter:r,removeFilter:o,updateFilter:i,filterConnector:c,setFilterConnector:f}=J();return e.jsx("div",{className:"filterContainer",children:e.jsxs("div",{className:"filterSubContainer",children:[e.jsxs("div",{className:"filterHeader",children:[e.jsxs("button",{onClick:r,children:[e.jsx(Be,{}),"Add Filter"]}),e.jsxs("div",{className:"filterConnector",children:[e.jsx("span",{children:"Combine filters by: "}),e.jsx(W,{options:["and","or"],selectedOption:c,setSelectedOption:u=>f(u),placeholder:"Select connector",clearable:!1})]})]}),e.jsx("div",{className:"filterRows",children:l.map((u,n)=>e.jsxs("div",{className:"filterRow"+(u.active?" active":""),children:[e.jsx(W,{options:s,selectedOption:u.attribute,setSelectedOption:a=>i(n,{...u,attribute:a,attributeType:t[s.indexOf(a)]||"string"}),placeholder:"Select an attribute",clearable:!0}),e.jsx(W,{options:u.attributeType==="number"?[...gt]:[...jt],selectedOption:u.operator,setSelectedOption:a=>i(n,{...u,operator:a}),placeholder:"Select operator"}),e.jsx("input",{type:u.attributeType==="number"?"number":"text",placeholder:`Enter ${u.attributeType} value`,value:u.value,onChange:a=>i(n,{...u,value:u.attributeType==="number"?parseFloat(a.target.value):a.target.value})}),e.jsx("button",{type:"button",className:`filterToggle ${u.active?"active":""}`,onClick:()=>{i(n,{...u,active:!u.active})},children:u.active?e.jsx(z,{}):e.jsx(q,{})}),e.jsx("button",{onClick:()=>o(n),children:e.jsx(oe,{})})]},n))})]})})},Ct=()=>{const{selectedLayer:s,setSelectedLayer:t,tableOpen:l,setTableOpen:r,filters:o,filterConnector:i}=J(),[c,f]=d.useState([]);d.useEffect(()=>{f(s.length>0?s[0].featureCollection.features.map((m,b)=>{const S={...m.properties||{},mugisSelected:!1,mugisIndex:b};return{...m,properties:S}}):[])},[s]);const u=d.useMemo(()=>{const m=new Set;return c.forEach(b=>{b&&b.properties&&Object.keys(b.properties).forEach(S=>m.add(S))}),m.delete("mugisSelected"),m.delete("mugisIndex"),m.forEach(b=>{c.map(N=>{var F;return(F=N.properties)==null?void 0:F[b]}).every(N=>Array.isArray(N)||N===null||N===void 0)&&m.delete(b)}),Array.from(m)},[c]),n=d.useMemo(()=>u.map(m=>c.map(S=>{var N;return(N=S.properties)==null?void 0:N[m]}).filter(S=>S!=null).every(S=>typeof S=="number")?"number":"string"),[u,c]),[a,h]=d.useState(!1),p=d.useMemo(()=>o.filter(m=>m.active),[o]),x=d.useMemo(()=>p.length===0?c:c.filter(m=>i==="and"?p.every(b=>ee(m,b)):p.some(b=>ee(m,b))),[c,p,i]),[g,j]=d.useState(null),[v,y]=d.useState(!0),L=d.useMemo(()=>g?[...x].sort((m,b)=>{const S=m&&m.properties&&g in m.properties?m.properties[g]??"":"",N=b&&b.properties&&g in b.properties?b.properties[g]??"":"";return S===N?0:S===void 0?1:N===void 0?-1:S<N?v?-1:1:S>N?v?1:-1:0}):x,[x,g,v]),C=m=>{g===m?v?y(!1):j(null):(j(m),y(!0))},{addLayer:E}=w(),[P,O]=d.useState(""),A=()=>{if(s.length===0){O("Please select a layer");return}if(c.length===0){O("No features available in the selected layer");return}const m=x.filter(b=>{var S;return(S=b.properties)==null?void 0:S.mugisSelected}).map(b=>({...b,properties:{...b.properties,mugisSelected:void 0,mugisIndex:void 0}}));if(m.length===0){O("Please select features to create a new layer");return}E({featureCollection:{type:"FeatureCollection",features:m},name:`selection(${s[0].name})`,outline:s[0].outline}),O(""),r(!1)},[T,U]=d.useState(1),[Z,fe]=d.useState(!1);return e.jsxs("div",{children:[e.jsx("button",{type:"button",className:"toolButton",onClick:()=>r(!l),children:e.jsx(ne,{})}),l&&e.jsx("div",{className:"cover",onClick:m=>{m.target===m.currentTarget&&r(!1)},children:e.jsxs("div",{className:"attributeTable",children:[e.jsx("button",{type:"button",className:"modalCloseButton",onClick:()=>r(!1),children:e.jsx(te,{})}),e.jsxs("div",{className:"modalHeader",children:[e.jsx("h3",{children:"Attribute Table"}),e.jsx("button",{type:"button",className:"infoButton",onClick:()=>fe(!Z),children:e.jsx(se,{})})]}),Z&&e.jsx("p",{className:"modalDescription",children:"This tool allows you to view and manage the attributes of features in a selected layer. You can filter, sort, and select features, and create a new layer from the selected features. Click on the column headers to sort by attribute. You can select individual features by clicking the checkbox in the first column, or all of them by clicking the checkbox in the header. Use the 'Create Layer From Selection' button to create a new layer from the selected features. To filter the displayed features, click 'Open Filter' and use the filter panel to set your criteria. Use 'Combine filters by AND' to require all conditions to be met, or 'Combine filters by OR' to allow any condition to be met."}),e.jsxs("div",{className:"tableInputHeader",children:[e.jsx(k,{selectedLayers:s,setSelectedLayers:t}),e.jsxs("button",{type:"button",className:`openFilterButton ${o.some(m=>m.active)?"active":""}`,onClick:()=>h(!a),children:[e.jsx(Ae,{})," ",a?"Close Filter":"Open Filter"]})]}),a&&e.jsx(St,{headers:u,headerTypes:n}),e.jsx("div",{className:"tableContainer",children:s.length>0&&e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("button",{type:"button",className:"selectAll",onClick:()=>{x.every(m=>{var b;return!((b=m.properties)!=null&&b.mugisSelected)})?f(m=>m.map(b=>{const S={...b.properties||{},mugisSelected:!0};return{...b,properties:S}})):f(m=>m.map(b=>{const S={...b.properties||{},mugisSelected:!1};return{...b,properties:S}}))},children:x.every(m=>m.properties.mugisSelected)?e.jsx(z,{}):x.every(m=>!m.properties.mugisSelected)?e.jsx(q,{}):e.jsx(Ue,{})})}),u.map((m,b)=>e.jsx("th",{children:e.jsxs("button",{type:"button",onClick:()=>C(m),children:[m,e.jsx("div",{className:"sortIcon",children:g===m&&(v?e.jsx(Ve,{}):e.jsx(We,{}))})]})},b))]})}),e.jsx("tbody",{children:L.slice((T-1)*100,T*100).map((m,b)=>{var S;return e.jsxs("tr",{className:(S=m.properties)!=null&&S.mugisSelected?"selected":"",children:[e.jsx("td",{children:e.jsx("button",{type:"button",onClick:()=>{f(N=>N.map((F,me)=>{var Y,_;if(me===((Y=m.properties)==null?void 0:Y.mugisIndex)){const he={...F.properties||{},mugisSelected:!((_=F.properties)!=null&&_.mugisSelected)};return{...F,properties:he}}return F}))},children:m.properties.mugisSelected?e.jsx(z,{}):e.jsx(q,{})})}),u.map((N,F)=>e.jsx("td",{children:m.properties&&!Array.isArray(m.properties[N])&&m.properties[N]!==null&&m.properties[N]!==void 0?String(m.properties[N]):""},F))]},b)})})]})}),s.length>0&&e.jsxs("div",{className:"tableFooter",children:[e.jsxs("span",{children:["Showing ",x.length," of ",c.length," features"]}),e.jsxs("div",{className:"tableFooterRight",children:[e.jsxs("span",{children:[(T-1)*100+1,"–",Math.min(T*100,x.length)," of ",x.length]}),e.jsxs("div",{className:"tablePagination",children:[e.jsx("button",{type:"button",onClick:()=>U(1),disabled:T<=1,children:e.jsx(He,{})}),e.jsx("button",{type:"button",onClick:()=>U(m=>Math.max(1,m-1)),disabled:T<=1,children:e.jsx(ze,{})}),e.jsx("button",{type:"button",onClick:()=>U(m=>Math.min(Math.ceil(x.length/100),m+1)),disabled:T>=Math.ceil(x.length/100),children:e.jsx(qe,{})}),e.jsx("button",{type:"button",onClick:()=>U(Math.ceil(x.length/100)),disabled:T>=Math.ceil(x.length/100),children:e.jsx(Ge,{})})]})]})]}),P&&e.jsx("p",{className:"modalErrorMessage",children:P}),e.jsxs("button",{type:"button",onClick:A,children:["Create Layer From Selection",x.filter(m=>{var b;return(b=m.properties)==null?void 0:b.mugisSelected}).length>0&&` (${x.filter(m=>{var b;return(b=m.properties)==null?void 0:b.mugisSelected}).length} selected)`]})]})})]})},Nt=({handleLoadFileInput:s})=>{const[t,l]=d.useState(!0),[r,o]=d.useState(300),{layers:i,toggleLayerVisibilityAll:c}=w(),{mapRef:f,mapReady:u}=$();d.useEffect(()=>{const h=setInterval(()=>{var p;(p=f.current)==null||p.resize()},1);setTimeout(()=>{clearInterval(h)},1)},[f,t]);const n=d.useRef(null),a=()=>{n.current&&n.current.click()};return e.jsxs("div",{className:`sidebarContainer ${t?"open":""}`,children:[e.jsx(yt,{setWidth:o,setOpen:l}),e.jsxs("aside",{className:"sidebar",style:{width:`${r}px`},children:[e.jsxs("div",{className:"sidebarHeader",children:[e.jsx("h2",{children:"Layers"}),e.jsxs("div",{className:"sidebarHeaderActions",children:[e.jsx(Ct,{}),e.jsx("button",{type:"button",onClick:c,children:i.every(h=>h.visible)?e.jsx(le,{}):e.jsx(ae,{})})]})]}),e.jsx("div",{className:"layerListContainer",children:u&&e.jsx(Lt,{})}),e.jsxs("div",{className:"sidebarFooter",children:[e.jsxs("button",{type:"button",onClick:a,children:[e.jsx(Je,{})," Load GeoJSON file"]}),e.jsx("input",{ref:n,type:"file",multiple:!0,accept:".geojson",onChange:s})]})]})]})};function wt(){const{addLayer:s}=w(),t=o=>{if(!o){console.log("no file selected");return}Array.from(o).forEach(i=>{const c=new FileReader;c.onload=f=>{var u;try{const n=JSON.parse((u=f.target)==null?void 0:u.result);if(n.type!=="FeatureCollection")throw new Error("Not a valid GeoJSON file, must be a FeatureCollection");s({featureCollection:n,name:i.name})}catch(n){console.log(n),alert("Error loading file: "+i.name+`
`+(n instanceof Error?n.message:String(n)))}},c.readAsText(i)})},l=o=>{t(o.target.files),o.target.value=""},r=o=>{o.preventDefault(),t(o.dataTransfer.files)};return e.jsxs("div",{className:"pageContainer",onDragOver:o=>o.preventDefault(),onDrop:r,children:[e.jsxs("header",{className:"mainHeader",children:[e.jsx("div",{className:"logo",children:e.jsx("a",{href:"https://github.com/tiltobias/mugis/",target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:"muGIS_banner.svg",alt:"muGIS logo"})})}),e.jsx(ht,{}),e.jsx(ot,{})]}),e.jsxs("main",{className:"mainContainer",children:[e.jsx(Nt,{handleLoadFileInput:l}),e.jsx("div",{className:"mapFlexContainer",children:e.jsx(st,{})})]})]})}Ze.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(wt,{})}));
